# 性交同意公正証書
[特定非営利活動法人法人日本弱者男性センター](https://men.or.jp/) (以下「法人」) で提供を検討している、  
性交の同意に関する証拠を  
- 安全
- 気軽
- 秘密

に保全するためのシステムである。
 
## デモ  
[ダウンロード](https://github.com/hiratatomotaka/sex_agree/archive/refs/heads/main.zip)

## 性交同意公正証書のデータフロー図
### 暗号化
![](./src/dfd_enc.png)

- 入力: 性交同意書  
- 出力: QRコード (暗号化済み性交同意書)  
- 必要なもの:
  - 合言葉(公証済み)
  - 同意時刻
- 副作用: 法人サーバ記憶
- 処理内容:  
フロー図の通り、合言葉と同意時刻からハッシュ値を計算し、このハッシュ値を鍵として性交同意書を暗号化する。  
暗号文がそのまま出力となるのではなく、**暗号文のハッシュ値** が QRコードとして出力される。

### 復号
![](./src/dfd_dec.png)

- 入力: QRコード (暗号化済み性交同意書)
- 出力: 性交同意書
- 必要なもの:
  - 「暗号化」で副作用を受けた法人サーバ
  - 合言葉(公証済み)
- 処理内容:
QRコードの写った写真を受け取ると、読み取られたデータを元に法人サーバへの問い合わせを行う。
問い合わせの結果 暗号文と同意時刻が特定される。
合言葉と同意時刻からハッシュ値を計算し、このハッシュ値を鍵として暗号文を復号する。  
復号結果がそのまま出力される。  
QRコードのデータは暗号文ではなく、あくまでもハッシュ値であるため、 **レインボーテーブルしていない限り復号は不可能** である。
レインボーテーブルは法人サーバが管理する。

## 想定される攻撃とその防御

### 1. 同意の有無に関するトラブル
性交について、事後にその同意の有無や内容で争いとなった場合、性交同意書を証拠として用いた問題解決を図ることが望まれる。  
しかし、性交同意書の信用が争点に含まれることも考えられる。  
性交同意書の信用を争う場合として、
- 否認 (性交同意書の作成自体を否定する場合)
- 改ざん・捏造 (性交同意書の内容の一部または全部を否定する場合)

が考えられる。  



#### 1-1. 否認防止


#### 1-2. 改ざん・捏造防止

### 2. 同意書を用いたリベンジポルノ

### 3. 弊法人・公証人による傍受
